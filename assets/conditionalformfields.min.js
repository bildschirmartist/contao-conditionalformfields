var ConditionalFormFields=new Class({initialize:function(e,t,n,r){var i=this;var s=document.id(document.body).getElement('input[name="FORM_SUBMIT"][value="'+e+'"]');if(s)this.form=s.getParent("form");if(!this.form){return}this.form.setProperty("novalidate","novalidate");this.triggers=t;this.conditions=r;this.form.addEvent("ajax_change",function(){i.loadFields(n)});this.loadFields(n)},loadFields:function(e){var t=this;this.fields={};e.forEach(function(e){var n=t.form.getElements('*[name*="'+e+'"]');if(n.length>0){n.forEach(function(n){var r=n.get("name");if(r.substr(r.length-2)=="[]"||n.get("type")=="radio"){if(!(t.fields[e]instanceof Array)){t.fields[e]=[]}t.fields[e].push(n)}else{t.fields[e]=n}})}});this.initOnChangeEvents();this.updateFieldVisibility()},initOnChangeEvents:function(){var e=this;var t=function(t){t.addEvent("change",function(){e.updateFieldVisibility()})};this.triggers.forEach(function(n){var r=e.fields[n];if(Array.isArray(r)){r.forEach(function(e){t(e)})}else{t(r)}})},updateFieldVisibility:function(){var e=this;this.showAllFields();var t=this.loadValuesFromAllFields();Object.each(this.conditions,function(n,r){n="var in_array = function(needle, haystack) { return Array.isArray(haystack) ? haystack.contains(needle) : false; }; "+n;var i=new Function("values",n);if(!i(t)&&e.fields[r]){e.hideField(e.fields[r])}})},loadValuesFromAllFields:function(){var e=[];Object.each(this.fields,function(t,n){if(Array.isArray(t)){e[n]=[];t.forEach(function(t){if((t.get("type")=="checkbox"||t.get("type")=="radio")&&t.checked){e[n].push(t.get("value"))}})}else{e[n]=t.get("value")}});return e},showAllFields:function(){var e=this;Object.each(this.fields,function(t){e.showField(t)})},showField:function(e){var t=function(e){var t=e.get("id");document.getElements('label[for="'+t+'"], #'+t+", #"+t+" + br").removeClass("invisible");e.getPrevious("p.error")&&e.getPrevious("p.error").removeClass("invisible");e.getParent(".select_container")&&e.getParent(".select_container").removeClass("invisible")};if(e instanceof Array){e.forEach(function(e){t(e)})}else{t(e)}},hideField:function(e){var t=function(e){var t=e.get("id");document.getElements('label[for="'+t+'"], #'+t+", #"+t+" + br").addClass("invisible");e.getPrevious("p.error")&&e.getPrevious("p.error").addClass("invisible");e.getParent(".select_container")&&e.getParent(".select_container").addClass("invisible")};if(e instanceof Array){e.forEach(function(e){t(e)})}else{t(e)}}});