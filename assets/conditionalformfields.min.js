var ConditionalFormFields=new Class({initialize:function(f,d,a,e){var c=this;var b=document.id(document.body).getElement('input[name="FORM_SUBMIT"][value="'+f+'"]');if(b){this.form=b.getParent("form")}if(!this.form){return}this.form.setProperty("novalidate","novalidate");this.triggers=d;this.conditions=e;this.form.addEvent("ajax_change",function(){c.loadFields(a)});this.loadFields(a)},loadFields:function(a){var b=this;this.fields={};a.forEach(function(d){var c=b.form.getElement('*[name="'+d+'"]');if(c){b.fields[d]=c}});this.initOnChangeEvents();this.updateFieldVisibility()},initOnChangeEvents:function(){var a=this;this.triggers.forEach(function(b){var c=a.fields[b];c.addEvent("change",function(){a.updateFieldVisibility()})})},updateFieldVisibility:function(){var b=this;this.showAllFields();var a=this.loadValuesFromAllFields();Object.each(this.conditions,function(e,d){var c=new Function("values",e);if(!c(a)){b.hideField(b.fields[d])}})},loadValuesFromAllFields:function(){var a=[];Object.each(this.fields,function(c,b){a[b]=c.get("value")});return a},showAllFields:function(){var a=this;Object.each(this.fields,function(b){a.showField(b)})},showField:function(b){var a=b.get("id");document.getElements('label[for="'+a+'"], #'+a+", #"+a+" + br").removeClass("invisible");b.getPrevious("p.error")&&b.getPrevious("p.error").removeClass("invisible");b.getParent(".select_container")&&b.getParent(".select_container").removeClass("invisible")},hideField:function(b){var a=b.get("id");document.getElements('label[for="'+a+'"], #'+a+", #"+a+" + br").addClass("invisible");b.getPrevious("p.error")&&b.getPrevious("p.error").addClass("invisible");b.getParent(".select_container")&&b.getParent(".select_container").addClass("invisible")}});